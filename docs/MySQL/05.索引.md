---
title: 索引
date: 2021-12-08 18:27:30
permalink: /pages/78fb1d/
categories:
  - MySQL
tags:
  - 索引
---
索引是为了加速对表中数据行进行检索而创建的一种分散存储的数据结构。

## 类型

### Hash索引  

索引只存储对应的hash值和行指针

+ 缺点
  + 不支持覆盖索引
  + 不支持范围比较
  + 不支持部分索引
  + hash冲突时需要遍历所有相关行进行比对，冲突代价比较高
+ 优点
  + 节省空间，比如对url建立索引

InnoDB引擎有一个特殊功能叫自适应哈希索引，当InnoDB注意到某些索引值被使用的非常频繁时，它会在内存中基于

### B+Tree  

树的高度决定了磁盘读取次数  
利用操作系统每次读取磁盘的一块区域到内存的性质，页大小16k

### 聚簇索引与非聚簇索引

聚簇索引：索引每个叶子结点存储主键、事务id、回滚指针、其他字段等。INNODB引擎
非聚簇索引：索引中存放的是数据物理块的指针。MYISAM引擎

## 使用

1. 当需要对过长的字符字段建立索引时，可以考虑前缀索引，即取字段前n个字符作为索引，而不是整个字段。
   eg. ALTER TABLE user ADD KEY (name(5));
   前缀索引无法做ORDER BY 和GROUP BY ，也无法做覆盖扫描
2. 将OR 改写成UNION
3. 使用覆盖索引，即索引中的字段包含了要查询字段，所以应避免使用select *，避免回表
4. 使用索引来做排序。在覆盖索引的基础上，使索引的列顺序与order by子句的顺序完全一致，并且列的排序方向（倒序或正序）都一样时，MySQL会使用索引来对结果进行排序。

5. 大表数据导入到其它数据库时，需在新数据库上先关闭索引，然后再添上索引，要不然效率就太低了。
6. 修改数据通过索引条件可以只锁部分行，如果不走索引会对表中所有数据行加行锁。

## 索引失效

1. 在索引上使用!=或<>
2. 使用or连接索引
3. 对于多列的索引，不按照顺序使用
4. 如果索引类型是字符串，不加引号会使得索引失效
5. like模糊匹配以%开始
6. 在索引字段上使用运算或函数
7. 索引值较少，比如枚举
