(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{610:function(s,a,e){"use strict";e.r(a);var t=e(10),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建集群"}},[s._v("#")]),s._v(" 创建集群")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("docker swarm init")]),s._v("  初始化集群")])]),s._v(" "),a("p",[s._v("输出示例：")]),s._v(" "),a("div",{staticClass:"language-PlainText line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("Swarm initialized: current node (1dayw2jss8e7pseq1dxaufo7s) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-0dm85ix64fa5j62hricif97kds21jj4aharkoqfuzfw22n10mc-9tlq05a1xafxnqtujj94t288k 10.0.10.131:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("如果服务器有多个网卡，可以在初始化时手动指定IP:"),a("code",[s._v("docker swarm init --advertise-addr [ip]")])]),s._v(" "),a("p",[s._v("初始化之后，当前节点就默认成了管理节点，初始化成功后，会给出加入Swarm集群的命令信息, 默认给出的命令使用的是以Worker节点加入集群的的Token，可以通过命令获取Manager节点的命令和Token")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Manager节点加入命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token manager\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Worker节点加入命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token worker\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"查看节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看节点"}},[s._v("#")]),s._v(" 查看节点")]),s._v(" "),a("p",[a("code",[s._v("docker node ls")])]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("STATUS")]),s._v(" 列显示节点的状态")]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("Ready")]),s._v("：\n节点已准备好接收任务。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Down")]),s._v("：\n节点不可用，可能是由于网络问题或节点宕机。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Disconnected")]),s._v("：\n节点与集群管理器失去连接。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Unknown")]),s._v("：\n节点状态未知，可能是由于网络问题或节点未响应。")])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("AVAILABILITY")]),s._v(" 列显示节点的可用性")]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("Active")]),s._v("：\n节点可用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Pause")]),s._v("：\n节点已暂停，不接受新任务。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Drain")]),s._v("：\n节点已暂停，不接受新任务，并且正在停止现有任务。")])])]),s._v(" "),a("p",[s._v("设置可用性 "),a("code",[s._v("docker node update --availability [节点名] [可用性]")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("MANAGER STATUS")]),s._v(" 列显示节点的管理器状态")]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("Leader")]),s._v("：\n节点是集群的管理器领导者。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Reachable")]),s._v("：\n节点是管理器，但不是领导者。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Unreachable")]),s._v("：\n节点是管理器，但无法与其他管理器通信。")])])])])]),s._v(" "),a("h4",{attrs:{id:"查看节点ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看节点ip"}},[s._v("#")]),s._v(" 查看节点IP")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Node: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$node")]),s._v('"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" inspect "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$node")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hostname: {{ .Description.Hostname }}, IP: {{ .Status.Addr }},'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"部署或更新服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署或更新服务"}},[s._v("#")]),s._v(" 部署或更新服务")]),s._v(" "),a("h3",{attrs:{id:"使用docker部署集群服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker部署集群服务"}},[s._v("#")]),s._v(" 使用docker部署集群服务")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建一个服务 "),a("code",[s._v("docker service create --name [服务名] [镜像名]")])])]),s._v(" "),a("li",[a("p",[s._v("更新服务 "),a("code",[s._v("docker service update --image [镜像名] [服务名]")])])]),s._v(" "),a("li",[a("p",[s._v("扩展服务 "),a("code",[s._v("docker service scale [服务名]=[数量]")])])]),s._v(" "),a("li",[a("p",[s._v("删除服务 "),a("code",[s._v("docker service rm [服务名]")])])]),s._v(" "),a("li",[a("p",[s._v("服务列表 "),a("code",[s._v("docker service ls")])])]),s._v(" "),a("li",[a("p",[s._v("查看服务详情 "),a("code",[s._v("docker service inspect [服务名]")])])]),s._v(" "),a("li",[a("p",[s._v("查看单个服务下的具体实例 "),a("code",[s._v("docker service ps [服务名]")])])])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker service ps --no-trunc [服务名]")]),s._v(" 显示完整信息，如果服务启动失败，可以查看错误信息")])]),s._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[s._v("查看服务日志 "),a("code",[s._v("docker service logs [服务名]")])])]),s._v(" "),a("h4",{attrs:{id:"服务参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务参数"}},[s._v("#")]),s._v(" 服务参数")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("--mode")]),s._v(" 指定服务的调度模式，有global和replicated两种模式")]),s._v(" "),a("li",[a("code",[s._v("--replicas")]),s._v(" 指定服务的副本数量")]),s._v(" "),a("li",[a("code",[s._v("--update-parallelism")]),s._v(" 指定更新服务时的并发数")]),s._v(" "),a("li",[a("code",[s._v("--update-delay")]),s._v(" 指定更新服务时的延迟时间")]),s._v(" "),a("li",[a("code",[s._v("--update-failure-action")]),s._v(" 指定更新服务失败时的处理方式")]),s._v(" "),a("li",[a("code",[s._v("--restart-condition")]),s._v(" 指定服务重启的条件")]),s._v(" "),a("li",[a("code",[s._v("--mount-add")]),s._v(" 指定挂载目录")]),s._v(" "),a("li",[a("code",[s._v("--limit-cpu")]),s._v(" 指定cpu限制")]),s._v(" "),a("li",[a("code",[s._v("--limit-memory")]),s._v(" 指定内存限制")]),s._v(" "),a("li",[a("code",[s._v("--constraint")]),s._v(" 指定服务部署在某个节点上")])]),s._v(" "),a("h4",{attrs:{id:"更新服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新服务"}},[s._v("#")]),s._v(" 更新服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("更新挂载目录 docker service update --mount-add source=[目录],target=[容器目录] [服务名]\n\n查看挂载目录 docker service inspect --format '{{json .Spec.TaskTemplate.ContainerSpec.Mounts}}' [服务名]\n\n查看cpu和内存限制 docker service inspect --format '{{json .Spec.TaskTemplate.Resources}}' [服务名]\n\n更新cpu和内存限制 docker service update --limit-cpu 0.5 --limit-memory 2g [服务名]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"回滚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚"}},[s._v("#")]),s._v(" 回滚")]),s._v(" "),a("p",[a("code",[s._v("docker service update --rollback [服务名]")])]),s._v(" "),a("h4",{attrs:{id:"指定节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定节点"}},[s._v("#")]),s._v(" 指定节点")]),s._v(" "),a("p",[s._v("通过"),a("code",[s._v("--constraint")]),s._v("参数可以指定服务部署在某个节点上：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("服务名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--constraint")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node.role==worker'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扩容缩容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" scale "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("服务名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("数量"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--constraint")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node.role==worker'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("code",[s._v("--constraint")]),s._v("参数可选的值有：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("node.role==manager")]),s._v("和"),a("code",[s._v("node.role==worker")]),s._v("，分别表示部署在管理节点和工作节点上")]),s._v(" "),a("li",[a("code",[s._v("node.hostname==[hostname]")]),s._v("，表示部署在指定主机上")]),s._v(" "),a("li",[a("code",[s._v("node.labels.[label]==[value]")]),s._v("，表示部署在具有指定标签的节点上")])]),s._v(" "),a("h3",{attrs:{id:"使用docker-compose部署集群服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker-compose部署集群服务"}},[s._v("#")]),s._v(" 使用docker-compose部署集群服务")]),s._v(" "),a("h4",{attrs:{id:"在docker-compose-yml文件中定义服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在docker-compose-yml文件中定义服务"}},[s._v("#")]),s._v(" 在docker-compose.yml文件中定义服务")]),s._v(" "),a("p",[s._v("配置文件例如：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.8'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("placement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("constraints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node.role == manager\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("update_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parallelism")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failure_action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rollback\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart_policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("deploy参数说明：")]),s._v(" "),a("ul",[a("li",[s._v("mode 指定服务的调度模式，有global和replicated两种模式, global表示每个节点上都运行一个实例，replicated，默认值，表示指定副本数量")]),s._v(" "),a("li",[s._v("replicas 服务副本数量")]),s._v(" "),a("li",[s._v("placement.constraints 指定服务的部署位置")]),s._v(" "),a("li",[s._v("update_config.parallelism 指定更新服务时的并发数")]),s._v(" "),a("li",[s._v("update_config.delay 指定更新服务时的延迟时间")]),s._v(" "),a("li",[s._v("update_config.failure_action 指定更新服务失败时的处理方式")]),s._v(" "),a("li",[s._v("restart_policy.condition 指定服务重启的条件")])]),s._v(" "),a("p",[s._v("这里引入了"),a("code",[s._v("stack")]),s._v("的概念，"),a("code",[s._v("stack")]),s._v("是一组服务的集合，可以通过"),a("code",[s._v("docker-compose.yml")]),s._v("文件来定义服务，然后通过"),a("code",[s._v("docker stack deploy")]),s._v("命令来部署服务.")]),s._v(" "),a("p",[s._v("这些服务拥有一个共同的服务栈名称，可以通过"),a("code",[s._v("docker stack")]),s._v("命令来管理这些服务。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("创建一个服务栈 "),a("code",[s._v("docker stack deploy -c [docker-compose.yml] [服务栈名]")]),s._v(","),a("code",[s._v("--detach=false")]),s._v(" 可以查看部署过程")])]),s._v(" "),a("li",[a("p",[s._v("查看服务栈 "),a("code",[s._v("docker stack services [服务栈名]")])])]),s._v(" "),a("li",[a("p",[s._v("查看服务栈中的服务 "),a("code",[s._v("docker stack ps [服务栈名]")])])]),s._v(" "),a("li",[a("p",[s._v("删除服务栈 "),a("code",[s._v("docker stack rm [服务栈名]")])])]),s._v(" "),a("li",[a("p",[s._v("更新服务栈 "),a("code",[s._v("docker stack deploy -c [docker-compose.yml] [服务栈名]")]),s._v("\n只有配置发生变化的服务会更新，其他服务不受影响")])])]),s._v(" "),a("p",[s._v("而对于每一个服务栈中的服务，依然可以通过"),a("code",[s._v("docker service")]),s._v("命令来管理，只是服务的名称会变成"),a("code",[s._v("服务栈名称_服务名称")]),s._v("的形式。")]),s._v(" "),a("h4",{attrs:{id:"docker-compose-yml变化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml变化"}},[s._v("#")]),s._v(" docker-compose.yml变化")]),s._v(" "),a("p",[s._v("用于集群部署的docker-compose.yml文件与单机部署的文件有一些不同")]),s._v(" "),a("p",[s._v("主要是增加了"),a("code",[s._v("deploy")]),s._v("字段，用于指定服务的部署策略。")]),s._v(" "),a("p",[s._v("之前设置的"),a("code",[s._v("restart")]),s._v("字段也在"),a("code",[s._v("deploy")]),s._v("字段中设置。")]),s._v(" "),a("p",[s._v("设置cpu和内存限制也在"),a("code",[s._v("deploy")]),s._v("字段中设置。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("update_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parallelism")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failure_action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rollback\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart_policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failure\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.5'")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2g\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"集群网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群网络"}},[s._v("#")]),s._v(" 集群网络")]),s._v(" "),a("p",[s._v("创建一个网络 "),a("code",[s._v("docker network create --driver overlay [网络名]")])])])}),[],!1,null,null,null);a.default=n.exports}}]);